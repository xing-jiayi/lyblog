<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.crushtj.blog.common.domain.mappers.TagMapper">

    <resultMap type="top.crushtj.blog.common.domain.dos.TagDo" id="TagMap">
        <result property="tagId" column="tag_id" jdbcType="INTEGER"/>
        <result property="tagName" column="tag_name" jdbcType="VARCHAR"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
        <result property="isDeleted" column="is_deleted" jdbcType="INTEGER"/>
    </resultMap>
    <select id="selectByName" resultType="top.crushtj.blog.common.domain.dos.TagDo">
        SELECT * FROM t_tag WHERE is_deleted = 0 AND tag_name = #{tagName}
    </select>
    <select id="queryAllTags" resultType="top.crushtj.blog.common.domain.dos.TagDo">
        SELECT * FROM t_tag WHERE is_deleted = 0 ORDER BY create_time DESC
    </select>
    <select id="queryTagPage" resultType="top.crushtj.blog.common.domain.dos.TagDo">
        SELECT * FROM t_tag
        WHERE is_deleted = 0
        <if test="searchVo.tagName != null and searchVo.tagName != ''">
            AND tag_name LIKE CONCAT('%', #{searchVo.tagName}, '%')
        </if>
        <if test="searchVo.createTimeStart != null">
            AND create_time &gt;= #{searchVo.createTimeStart}
        </if>
        <if test="searchVo.createTimeEnd != null">
            AND create_time &lt;= #{searchVo.createTimeEnd}
        </if>
        ORDER BY create_time DESC
    </select>
    <select id="selectByArticleId" resultType="top.crushtj.blog.common.domain.dos.vo.tag.TagVo">
        SELECT t.tag_id, t.tag_name FROM t_tag t
        LEFT JOIN t_article_tag_rel atr ON t.tag_id = atr.tag_id AND atr.is_deleted = 0
        WHERE atr.article_id = #{articleId} AND t.is_deleted = 0
    </select>

</mapper>
